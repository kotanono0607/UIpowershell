<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIpowershell - ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ†ã‚¹ãƒˆ</title>
    <style>
        /* Neumorphism + Aurora Design */
        :root {
            --bg-color: #e0e5ec;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --aurora-purple: #667eea;
            --aurora-pink: #f472b6;
            --aurora-cyan: #06b6d4;
            --aurora-green: #10b981;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Yu Gothic UI', sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ */
        .breadcrumb-bar {
            height: 40px;
            background: var(--bg-color);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 10px;
            box-shadow: 
                0 3px 6px var(--shadow-dark),
                0 -2px 4px var(--shadow-light);
            z-index: 100;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 5px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: var(--bg-color);
            box-shadow: 
                2px 2px 4px var(--shadow-dark),
                -2px -2px 4px var(--shadow-light);
        }

        .breadcrumb-item:hover {
            box-shadow: 
                3px 3px 6px var(--shadow-dark),
                -3px -3px 6px var(--shadow-light);
            transform: translateY(-1px);
        }

        .breadcrumb-separator {
            color: var(--text-secondary);
            user-select: none;
        }

        .breadcrumb-item.current {
            background: linear-gradient(135deg, var(--aurora-purple), var(--aurora-pink));
            color: white;
            font-weight: bold;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .main-container {
            display: flex;
            flex: 1;
            gap: 20px;
            padding: 20px;
            overflow: hidden;
        }

        /* ãƒ‘ãƒãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .panel {
            background: var(--bg-color);
            border-radius: 20px;
            padding: 20px;
            overflow-y: auto;
            transition: all 0.4s ease;
            box-shadow: 
                9px 9px 18px var(--shadow-dark),
                -9px -9px 18px var(--shadow-light);
        }

        /* å·¦ãƒ‘ãƒãƒ« */
        .left-panel {
            width: 400px;
            position: relative;
        }

        .left-panel.dimmed {
            opacity: 0.3;
            pointer-events: none;
        }

        /* å³ãƒ‘ãƒãƒ« */
        .right-panel {
            flex: 1;
            position: relative;
        }

        .right-panel.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* ãƒ‘ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .panel-header {
            height: 40px;
            background: linear-gradient(135deg, var(--aurora-purple), var(--aurora-pink));
            margin: -20px -20px 20px -20px;
            border-radius: 20px 20px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        /* ãƒãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .node {
            background: var(--bg-color);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 12px 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 
                4px 4px 8px var(--shadow-dark),
                -4px -4px 8px var(--shadow-light);
        }

        .node:hover {
            transform: translateX(5px);
            box-shadow: 
                6px 6px 12px var(--shadow-dark),
                -6px -6px 12px var(--shadow-light);
        }

        /* ãƒ”ãƒ³ã‚¯ãƒãƒ¼ãƒ‰ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼åŒ–ï¼‰*/
        .node.pink {
            background: 
                linear-gradient(var(--bg-color), var(--bg-color)) padding-box,
                linear-gradient(135deg, var(--aurora-pink), #ec4899) border-box;
            font-weight: bold;
            animation: pinkGlow 2s ease-in-out infinite;
        }

        @keyframes pinkGlow {
            0%, 100% {
                box-shadow: 
                    4px 4px 8px var(--shadow-dark),
                    -4px -4px 8px var(--shadow-light),
                    0 0 20px rgba(236, 72, 153, 0.3);
            }
            50% {
                box-shadow: 
                    4px 4px 8px var(--shadow-dark),
                    -4px -4px 8px var(--shadow-light),
                    0 0 40px rgba(236, 72, 153, 0.5);
            }
        }

        .node.pink::before {
            content: 'ğŸŸ£';
            margin-right: 8px;
        }

        /* é¸æŠä¸­ã®ãƒãƒ¼ãƒ‰ */
        .node.selected {
            background: 
                linear-gradient(var(--bg-color), var(--bg-color)) padding-box,
                linear-gradient(135deg, var(--aurora-purple), var(--aurora-cyan)) border-box;
            transform: translateX(10px);
        }

        /* ãƒ›ãƒãƒ¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .hover-preview {
            position: absolute;
            background: var(--bg-color);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 
                8px 8px 16px var(--shadow-dark),
                -8px -8px 16px var(--shadow-light);
            z-index: 1000;
            display: none;
            min-width: 250px;
            max-width: 350px;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.3s ease;
        }

        .hover-preview.show {
            display: block;
            opacity: 0.95;
            transform: scale(1);
        }

        .hover-preview-header {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--shadow-dark);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hover-preview-content {
            font-size: 12px;
            line-height: 1.6;
        }

        .hover-preview-item {
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
        }

        .hover-preview-item::before {
            content: 'â”œâ”€';
            position: absolute;
            left: 0;
            color: var(--text-secondary);
        }

        .hover-preview-item:last-child::before {
            content: 'â””â”€';
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutToRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-in {
            animation: slideInFromRight 0.4s ease-out;
        }

        .slide-out {
            animation: slideOutToRight 0.4s ease-out;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        /* ãƒãƒ¼ãƒ‰å†…å®¹ã‚¨ãƒªã‚¢ */
        .node-content-area {
            padding: 10px;
        }

        /* ESCã‚­ãƒ¼ãƒ’ãƒ³ãƒˆ */
        .esc-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-color);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            box-shadow: 
                4px 4px 8px var(--shadow-dark),
                -4px -4px 8px var(--shadow-light);
            display: none;
            z-index: 100;
        }

        .esc-hint.show {
            display: block;
        }

        /* ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        .layer-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, var(--aurora-purple), var(--aurora-pink));
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }

        /* ãƒãƒ¼ãƒ‰ãƒ„ãƒªãƒ¼æ§‹é€ ã®ç·š */
        .node-tree-line {
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(180deg, 
                var(--aurora-purple) 0%, 
                var(--aurora-pink) 100%);
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <!-- ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->
    <div class="breadcrumb-bar" id="breadcrumb">
        <div class="breadcrumb-item" data-layer="1">
            ğŸ“ ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="main-container">
        <!-- å·¦ãƒ‘ãƒãƒ« -->
        <div class="panel left-panel" id="leftPanel">
            <div class="panel-header">ãƒ¬ã‚¤ãƒ¤ãƒ¼1 - ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼</div>
            <div class="layer-indicator">L1</div>
            
            <div class="node-content-area">
                <div class="node">Excelèª­è¾¼</div>
                <div class="node pink" data-layer="2" data-name="ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†">
                    ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
                </div>
                <div class="node">Webå…¥åŠ›</div>
                <div class="node pink" data-layer="3" data-name="ãƒ‡ãƒ¼ã‚¿å–å¾—">
                    ãƒ‡ãƒ¼ã‚¿å–å¾—
                </div>
                <div class="node">Excelå‡ºåŠ›</div>
                <div class="node pink" data-layer="4" data-name="ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ">
                    ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ
                </div>
                <div class="node">å®Œäº†é€šçŸ¥</div>
            </div>
        </div>

        <!-- å³ãƒ‘ãƒãƒ« -->
        <div class="panel right-panel empty" id="rightPanel">
            <span>ãƒ”ãƒ³ã‚¯ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</span>
        </div>
    </div>

    <!-- ãƒ›ãƒãƒ¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div class="hover-preview" id="hoverPreview">
        <div class="hover-preview-header">
            <span>ğŸ”</span>
            <span id="previewTitle">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
        </div>
        <div class="hover-preview-content" id="previewContent">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
    </div>

    <!-- ESCã‚­ãƒ¼ãƒ’ãƒ³ãƒˆ -->
    <div class="esc-hint" id="escHint">
        ESCã‚­ãƒ¼ã§æˆ»ã‚‹
    </div>

    <script>
        // ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        const layerData = {
            2: {
                name: 'ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†',
                nodes: [
                    { text: 'ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•', type: 'normal' },
                    { text: 'URLå…¥åŠ›', type: 'normal' },
                    { text: 'IDå…¥åŠ›', type: 'normal' },
                    { text: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›', type: 'normal' },
                    { text: 'å¤šè¦ç´ èªè¨¼', type: 'pink', layer: 5 },
                    { text: 'ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³', type: 'normal' },
                    { text: 'æˆåŠŸç¢ºèª', type: 'normal' }
                ]
            },
            3: {
                name: 'ãƒ‡ãƒ¼ã‚¿å–å¾—',
                nodes: [
                    { text: 'æ¤œç´¢æ¡ä»¶è¨­å®š', type: 'normal' },
                    { text: 'æ¤œç´¢å®Ÿè¡Œ', type: 'normal' },
                    { text: 'çµæœç¢ºèª', type: 'normal' },
                    { text: 'ãƒ‡ãƒ¼ã‚¿æŠ½å‡º', type: 'pink', layer: 6 },
                    { text: 'CSVä¿å­˜', type: 'normal' }
                ]
            },
            4: {
                name: 'ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ',
                nodes: [
                    { text: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­è¾¼', type: 'normal' },
                    { text: 'ãƒ‡ãƒ¼ã‚¿æ•´å½¢', type: 'normal' },
                    { text: 'ã‚°ãƒ©ãƒ•ä½œæˆ', type: 'pink', layer: 7 },
                    { text: 'PDFå‡ºåŠ›', type: 'normal' }
                ]
            },
            5: {
                name: 'å¤šè¦ç´ èªè¨¼',
                nodes: [
                    { text: 'SMSå¾…æ©Ÿ', type: 'normal' },
                    { text: 'ã‚³ãƒ¼ãƒ‰å…¥åŠ›', type: 'normal' },
                    { text: 'ç¢ºèªãƒœã‚¿ãƒ³', type: 'normal' }
                ]
            },
            6: {
                name: 'ãƒ‡ãƒ¼ã‚¿æŠ½å‡º',
                nodes: [
                    { text: 'ãƒ†ãƒ¼ãƒ–ãƒ«é¸æŠ', type: 'normal' },
                    { text: 'åˆ—é¸æŠ', type: 'normal' },
                    { text: 'ãƒ•ã‚£ãƒ«ã‚¿è¨­å®š', type: 'normal' },
                    { text: 'æŠ½å‡ºå®Ÿè¡Œ', type: 'normal' }
                ]
            },
            7: {
                name: 'ã‚°ãƒ©ãƒ•ä½œæˆ',
                nodes: [
                    { text: 'ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒ—é¸æŠ', type: 'normal' },
                    { text: 'ãƒ‡ãƒ¼ã‚¿ç¯„å›²è¨­å®š', type: 'normal' },
                    { text: 'ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š', type: 'normal' },
                    { text: 'æç”»', type: 'normal' }
                ]
            }
        };

        // çŠ¶æ…‹ç®¡ç†
        let currentLeftLayer = 1;
        let selectedNode = null;
        let hoverTimer = null;
        let breadcrumbStack = [
            { name: 'ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼', layer: 1 }
        ];

        // ãƒ›ãƒãƒ¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®š
        function setupHoverPreview() {
            const pinkNodes = document.querySelectorAll('.node.pink');
            
            pinkNodes.forEach(node => {
                node.addEventListener('mouseenter', (e) => {
                    const layerId = parseInt(node.dataset.layer);
                    const layerName = node.dataset.name;
                    
                    // ã‚¿ã‚¤ãƒãƒ¼è¨­å®šï¼ˆ0.8ç§’å¾Œã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼‰
                    hoverTimer = setTimeout(() => {
                        showPreview(e, layerId, layerName);
                    }, 800);
                });

                node.addEventListener('mouseleave', () => {
                    clearTimeout(hoverTimer);
                    hidePreview();
                });
            });
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        function showPreview(event, layerId, layerName) {
            const preview = document.getElementById('hoverPreview');
            const previewTitle = document.getElementById('previewTitle');
            const previewContent = document.getElementById('previewContent');
            
            // ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š
            previewTitle.textContent = `ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼: ${layerName}`;
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ
            const layerInfo = layerData[layerId];
            if (layerInfo) {
                previewContent.innerHTML = '';
                layerInfo.nodes.slice(0, 5).forEach((node, index) => {
                    const item = document.createElement('div');
                    item.className = 'hover-preview-item';
                    item.textContent = node.text;
                    if (node.type === 'pink') {
                        item.innerHTML = 'ğŸŸ£ ' + item.textContent;
                    }
                    previewContent.appendChild(item);
                });
                
                if (layerInfo.nodes.length > 5) {
                    const more = document.createElement('div');
                    more.className = 'hover-preview-item';
                    more.textContent = `... ä»–${layerInfo.nodes.length - 5}ä»¶`;
                    more.style.color = 'var(--text-secondary)';
                    previewContent.appendChild(more);
                }
            }
            
            // ä½ç½®èª¿æ•´
            const rect = event.target.getBoundingClientRect();
            preview.style.left = rect.right + 10 + 'px';
            preview.style.top = rect.top + 'px';
            
            // è¡¨ç¤º
            preview.classList.add('show');
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼éè¡¨ç¤º
        function hidePreview() {
            const preview = document.getElementById('hoverPreview');
            preview.classList.remove('show');
        }

        // ãƒ”ãƒ³ã‚¯ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function setupNodeClick() {
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('node') && e.target.classList.contains('pink')) {
                    const layerId = parseInt(e.target.dataset.layer);
                    const layerName = e.target.dataset.name;
                    
                    // é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
                    if (selectedNode) {
                        selectedNode.classList.remove('selected');
                    }
                    selectedNode = e.target;
                    selectedNode.classList.add('selected');
                    
                    // å·¦ãƒ‘ãƒãƒ«ã‚’è–„ã
                    document.getElementById('leftPanel').classList.add('dimmed');
                    
                    // å³ãƒ‘ãƒãƒ«ã«è©³ç´°ã‚’è¡¨ç¤º
                    showLayerInRightPanel(layerId, layerName);
                    
                    // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆæ›´æ–°
                    updateBreadcrumb(layerName, layerId);
                    
                    // ESCãƒ’ãƒ³ãƒˆè¡¨ç¤º
                    document.getElementById('escHint').classList.add('show');
                }
                
                // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
                if (e.target.classList.contains('breadcrumb-item') && !e.target.classList.contains('current')) {
                    const targetLayer = parseInt(e.target.dataset.layer);
                    navigateToLayer(targetLayer);
                }
            });
        }

        // å³ãƒ‘ãƒãƒ«ã«è©³ç´°è¡¨ç¤º
        function showLayerInRightPanel(layerId, layerName) {
            const rightPanel = document.getElementById('rightPanel');
            const layerInfo = layerData[layerId];
            
            if (!layerInfo) return;
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹è¿½åŠ 
            rightPanel.classList.add('slide-in');
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ
            rightPanel.classList.remove('empty');
            rightPanel.innerHTML = `
                <div class="panel-header">ãƒ¬ã‚¤ãƒ¤ãƒ¼${layerId} - ${layerName}</div>
                <div class="layer-indicator">L${layerId}</div>
                <div class="node-content-area">
                    <div class="node-tree-line"></div>
                    ${layerInfo.nodes.map(node => {
                        const pinkClass = node.type === 'pink' ? 'pink' : '';
                        const dataAttr = node.layer ? `data-layer="${node.layer}" data-name="${node.text}"` : '';
                        const emoji = node.type === 'pink' ? '' : '';
                        return `<div class="node ${pinkClass}" ${dataAttr}>${emoji}${node.text}</div>`;
                    }).join('')}
                </div>
            `;
            
            // æ–°ã—ã„ãƒ”ãƒ³ã‚¯ãƒãƒ¼ãƒ‰ã«ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
            setTimeout(() => {
                rightPanel.classList.remove('slide-in');
                setupHoverPreviewForPanel(rightPanel);
                setupNodeClickForPanel(rightPanel);
            }, 400);
        }

        // å³ãƒ‘ãƒãƒ«å†…ã®ãƒ”ãƒ³ã‚¯ãƒãƒ¼ãƒ‰ç”¨ã‚¤ãƒ™ãƒ³ãƒˆ
        function setupHoverPreviewForPanel(panel) {
            const pinkNodes = panel.querySelectorAll('.node.pink');
            
            pinkNodes.forEach(node => {
                node.addEventListener('mouseenter', (e) => {
                    const layerId = parseInt(node.dataset.layer);
                    const layerName = node.dataset.name;
                    
                    if (layerId && layerName) {
                        hoverTimer = setTimeout(() => {
                            showPreview(e, layerId, layerName);
                        }, 800);
                    }
                });

                node.addEventListener('mouseleave', () => {
                    clearTimeout(hoverTimer);
                    hidePreview();
                });
            });
        }

        // å³ãƒ‘ãƒãƒ«å†…ã®ãƒ”ãƒ³ã‚¯ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function setupNodeClickForPanel(panel) {
            const pinkNodes = panel.querySelectorAll('.node.pink');
            
            pinkNodes.forEach(node => {
                node.addEventListener('click', (e) => {
                    const layerId = parseInt(node.dataset.layer);
                    const layerName = node.dataset.name;
                    
                    if (layerId && layerName) {
                        // ã•ã‚‰ã«æ·±ã„éšå±¤ã¸
                        showLayerInRightPanel(layerId, layerName);
                        updateBreadcrumb(layerName, layerId);
                    }
                });
            });
        }

        // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆæ›´æ–°
        function updateBreadcrumb(name, layer) {
            breadcrumbStack.push({ name, layer });
            renderBreadcrumb();
        }

        // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆæç”»
        function renderBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '';
            
            breadcrumbStack.forEach((item, index) => {
                const breadcrumbItem = document.createElement('div');
                breadcrumbItem.className = 'breadcrumb-item';
                breadcrumbItem.dataset.layer = item.layer;
                breadcrumbItem.textContent = index === 0 ? 'ğŸ“ ' + item.name : item.name;
                
                if (index === breadcrumbStack.length - 1) {
                    breadcrumbItem.classList.add('current');
                }
                
                breadcrumb.appendChild(breadcrumbItem);
                
                if (index < breadcrumbStack.length - 1) {
                    const separator = document.createElement('span');
                    separator.className = 'breadcrumb-separator';
                    separator.textContent = 'â†’';
                    breadcrumb.appendChild(separator);
                }
            });
        }

        // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ç§»å‹•
        function navigateToLayer(targetLayer) {
            if (targetLayer === 1) {
                // ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã«æˆ»ã‚‹
                navigateBack();
            } else {
                // ç‰¹å®šã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ç§»å‹•
                const targetIndex = breadcrumbStack.findIndex(item => item.layer === targetLayer);
                if (targetIndex !== -1) {
                    breadcrumbStack = breadcrumbStack.slice(0, targetIndex + 1);
                    renderBreadcrumb();
                    
                    const lastItem = breadcrumbStack[breadcrumbStack.length - 1];
                    showLayerInRightPanel(lastItem.layer, lastItem.name);
                }
            }
        }

        // æˆ»ã‚‹å‡¦ç†
        function navigateBack() {
            // é¸æŠè§£é™¤
            if (selectedNode) {
                selectedNode.classList.remove('selected');
                selectedNode = null;
            }
            
            // å·¦ãƒ‘ãƒãƒ«ã‚’å…ƒã«æˆ»ã™
            document.getElementById('leftPanel').classList.remove('dimmed');
            
            // å³ãƒ‘ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢
            const rightPanel = document.getElementById('rightPanel');
            rightPanel.classList.add('slide-out');
            
            setTimeout(() => {
                rightPanel.classList.add('empty');
                rightPanel.classList.remove('slide-out');
                rightPanel.innerHTML = '<span>ãƒ”ãƒ³ã‚¯ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</span>';
            }, 400);
            
            // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            breadcrumbStack = [{ name: 'ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼', layer: 1 }];
            renderBreadcrumb();
            
            // ESCãƒ’ãƒ³ãƒˆéè¡¨ç¤º
            document.getElementById('escHint').classList.remove('show');
        }

        // ESCã‚­ãƒ¼å‡¦ç†
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && breadcrumbStack.length > 1) {
                navigateBack();
            }
        });

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            setupHoverPreview();
            setupNodeClick();
            renderBreadcrumb();
        });

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä½ç½®èª¿æ•´
        window.addEventListener('resize', () => {
            hidePreview();
        });
    </script>
</body>
</html>