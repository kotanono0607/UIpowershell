# UIpowershell - ビジュアルRPA自動化プラットフォーム

## 機能概要ドキュメント（BPR担当者向け）

---

## 目次

1. [製品概要](#1-製品概要)
2. [対象ユーザーと利用シーン](#2-対象ユーザーと利用シーン)
3. [主要機能一覧](#3-主要機能一覧)
4. [ノード機能詳細（全13カテゴリ・130+ノード）](#4-ノード機能詳細全13カテゴリ130ノード)
5. [ワークフローエディタ機能](#5-ワークフローエディタ機能)
6. [自動化可能な業務領域](#6-自動化可能な業務領域)
7. [システム構成・技術仕様](#7-システム構成技術仕様)
8. [導入・セットアップ](#8-導入セットアップ)

---

## 1. 製品概要

### 1.1 UIpowershellとは

**UIpowershell**は、PowerShellベースのビジュアルワークフロー構築ツールです。プログラミング知識がなくても、**ドラッグ＆ドロップ操作**でRPA（Robotic Process Automation）処理を設計・実行できます。

### 1.2 特徴

| 項目 | 内容 |
|------|------|
| **ノーコード/ローコード** | プログラミング不要でワークフロー構築可能 |
| **ビジュアル設計** | フローチャート形式で処理の流れを可視化 |
| **130+の自動化ノード** | Excel、ブラウザ、ファイル操作など豊富な機能 |
| **条件分岐・ループ対応** | 複雑なビジネスロジックを表現可能 |
| **再利用可能なサブルーチン** | 処理をモジュール化して効率的に管理 |
| **Undo/Redo機能** | 安心して試行錯誤が可能 |

### 1.3 主な用途

- **Excelデータ → Webシステムへの自動転記**
- **アプリケーション/ウインドウの自動操作**
- **画像マッチングによるUI自動化**
- **キーボード/マウス自動操作**
- **複雑な条件分岐・ループ処理の自動化**

---

## 2. 対象ユーザーと利用シーン

### 2.1 対象ユーザー

| ユーザー層 | 活用方法 |
|-----------|---------|
| **業務担当者** | 日常業務の自動化（Excel転記、データ入力など） |
| **BPR/DX推進担当** | 業務プロセス改善、効率化施策の実装 |
| **情報システム部門** | 社内システム連携、定期処理の自動化 |
| **管理者・マネージャー** | レポート自動生成、定期集計業務 |

### 2.2 推奨利用シーン

#### 即効性が高いシーン

1. **定期的なデータ転記業務**
   - 例：月次経費精算データのシステム登録
   - 例：日次売上データのExcel集計

2. **複数システム間のデータ連携**
   - 例：ERPシステム → Excel → 営業支援システム
   - 例：メール添付ファイル → 社内データベース

3. **大量データの一括処理**
   - 例：数千件のCSVデータをWebシステムに自動登録
   - 例：複数Excelファイルの統合・集計

4. **定時レポート作成**
   - 例：営業日報の自動集約
   - 例：経営ダッシュボード更新

---

## 3. 主要機能一覧

### 3.1 機能カテゴリ概要

| カテゴリ | ノード数 | 主な機能 |
|---------|---------|---------|
| 制御構文 | 9 | 順次処理、条件分岐、ループ |
| マウス操作 | 8 | クリック、移動、ダブルクリック |
| キーボード操作 | 9 | 文字入力、ショートカット、IME制御 |
| UIAutomation | 6 | UI要素操作、スクロール |
| 起動・実行 | 7 | アプリ起動、URL開く、コマンド実行 |
| データ操作 | 12 | 文字列処理、日付計算、変数管理 |
| ユーザー対話 | 9 | メッセージ表示、入力ダイアログ |
| Excel(データ) | 16 | Excel読込/書込、配列操作 |
| ウインドウ操作 | 9 | ウインドウ制御、表示管理 |
| 画像処理 | 6 | 画像マッチング、スクリーンショット |
| ファイル操作 | 10 | ファイルコピー、テキスト読書 |
| 共通処理 | 5 | 待機、ログ出力、コメント |
| Excel(操作) | 16 | セル単位操作、書式設定 |
| **合計** | **130+** | - |

### 3.2 ノードタイプと視覚表現

| ノードタイプ | 色 | 用途 |
|-------------|-----|------|
| **順次処理** | 白 | 通常の処理ステップ |
| **条件分岐** | 黄緑（SpringGreen） | if-else構造の表現 |
| **ループ** | 黄色（LemonChiffon） | 繰り返し処理 |
| **特殊処理** | サーモン | 制御構造内の処理 |
| **スクリプト化** | ピンク | サブルーチン化した処理 |

---

## 4. ノード機能詳細（全13カテゴリ・130+ノード）

### 4.1 制御構文（9ノード）

業務ロジックの基本構造を定義します。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **順次** | 通常の処理ステップ | 基本的な処理の配置 |
| **変数比較** | 2つの値を比較して分岐 | 金額が10万円以上なら承認処理へ |
| **空チェック** | 値が空かどうかで分岐 | 入力値がなければエラー表示 |
| **ファイル存在** | ファイルの有無で分岐 | 設定ファイルがあれば読み込み |
| **文字列含む** | 特定文字列の有無で分岐 | エラーメッセージに「失敗」が含まれるか |
| **多分岐** | 複数条件での分岐 | ステータスによって処理を振り分け |
| **固定回数ループ** | 指定回数繰り返す | 3回リトライ処理 |
| **コレクションループ** | リストの各要素で繰り返す | Excel各行に対して処理 |
| **条件ループ** | 条件を満たす間繰り返す | 成功するまで処理を継続 |

### 4.2 マウス操作（8ノード）

画面上のマウス操作を自動化します。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **座標指定クリック** | 指定座標をクリック | 固定位置のボタンをクリック |
| **マウス移動** | 指定座標へ移動 | ツールチップ表示のためホバー |
| **ダブルクリック** | 指定座標をダブルクリック | ファイルを開く |
| **右クリック** | 指定座標を右クリック | コンテキストメニュー表示 |
| **画面中央移動** | マウスを画面中央へ | 初期位置にリセット |
| **相対クリック** | ウインドウ相対位置でクリック | ウインドウ位置に依存しない操作 |
| **ドラッグ** | ドラッグ操作 | ファイルの移動 |
| **スクロール** | マウスホイール操作 | ページをスクロール |

### 4.3 キーボード操作（9ノード）

キーボード入力を自動化します。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **ショートカットキー送信** | Ctrl+Cなどの送信 | コピー＆ペースト操作 |
| **1文字ずつ入力** | 文字を順次入力 | フォームへのテキスト入力 |
| **クリップボード貼付** | クリップボードから貼付 | 大量テキストの高速入力 |
| **キーワード検索** | Ctrl+F + 検索語入力 | ページ内検索 |
| **キー連打** | 同じキーを繰り返し | Tabキー連打でフォーカス移動 |
| **キーシーケンス** | 複数キーを順次送信 | 複合キー操作 |
| **変数から入力** | 変数値をキー入力 | 動的な値の入力 |
| **IME切替** | 日本語入力ON/OFF | 入力モード制御 |
| **カスタムキー送信** | 任意のキー送信 | 特殊キー操作 |

### 4.4 UIAutomation（6ノード）

Windowsアプリケーションの UI 要素を操作します。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **UI操作** | UI要素を操作 | ボタン、テキストボックスの操作 |
| **UI要素チェック** | 要素の存在確認 | ダイアログが表示されているか |
| **ページスクロール** | 上下スクロール | Webページの表示範囲移動 |
| **ページ末尾へ** | ページ最下部へ移動 | 全データ読み込み |
| **ページ先頭へ** | ページ最上部へ移動 | 先頭に戻る |
| **テキスト要素クリック** | テキストで要素を特定しクリック | 「登録」ボタンをクリック |

### 4.5 起動・実行（7ノード）

アプリケーションやプロセスを制御します。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **アプリ実行** | アプリケーション起動 | Excelを起動 |
| **URLを開く** | ブラウザでURL開く | 業務システムにアクセス |
| **ファイルを開く** | 関連アプリでファイル開く | PDFファイルを開く |
| **コマンド実行** | コマンドプロンプト実行 | バッチ処理実行 |
| **プロセス終了** | アプリケーション終了 | 処理完了後にアプリを閉じる |
| **PowerShell実行** | PowerShellスクリプト実行 | カスタム処理 |
| **プロセス待機** | 起動完了を待つ | アプリが準備完了するまで待機 |

### 4.6 データ操作（12ノード）

変数や文字列の操作を行います。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **クリップボード取得** | クリップボードの値を取得 | コピーした値を変数に格納 |
| **クリップボード格納** | 値をクリップボードに設定 | 貼り付け用データ準備 |
| **変数取得** | 変数の値を取得 | 保存した値の参照 |
| **変数設定** | 変数に値を設定 | 計算結果の保存 |
| **文字列結合** | 複数文字列を連結 | 「姓」+「名」でフルネーム作成 |
| **文字列分割** | 区切り文字で分割 | CSVデータの分解 |
| **文字列置換** | 特定文字列を置換 | 全角を半角に変換 |
| **部分抽出** | 文字列の一部を抽出 | 郵便番号の先頭3桁取得 |
| **現在日時取得** | 現在の日時を取得 | タイムスタンプ付与 |
| **日付計算** | 日付の加減算 | 3日後の日付を計算 |
| **数値演算** | 四則演算 | 合計金額の計算 |
| **型変換** | データ型変換 | 文字列を数値に変換 |

### 4.7 ユーザー対話（9ノード）

ユーザーとの対話を行います。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **メッセージボックス表示** | 情報を表示 | 処理完了通知 |
| **入力ダイアログ** | ユーザー入力を受付 | 処理対象ファイル名の入力 |
| **確認ダイアログ** | はい/いいえの確認 | 処理続行の確認 |
| **ファイル選択** | ファイル選択ダイアログ | 処理対象ファイルの選択 |
| **フォルダ選択** | フォルダ選択ダイアログ | 出力先フォルダの選択 |
| **リスト選択** | 選択肢から選ぶ | 処理モードの選択 |
| **進捗表示** | 進捗状況を表示 | 処理進行状況の可視化 |
| **通知トースト** | デスクトップ通知 | バックグラウンド処理完了通知 |
| **デバッグ表示** | デバッグ情報表示 | 開発時の動作確認 |

### 4.8 Excel(データ)（16ノード）

Excelファイルを配列として一括処理します。**大量データ処理に最適**です。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **Excel読込** | ファイルを配列に読込 | CSVデータを一括読み込み |
| **Excel書込** | 配列をファイルに保存 | 処理結果をExcelに出力 |
| **変数ビューア** | 配列データをグリッド表示 | データ内容の確認 |
| **セル値取得** | 特定セルの値を取得 | A1セルの値を変数に |
| **行ループ** | 各行で繰り返し処理 | 全行に対して処理実行 |
| **条件検索** | 条件に合う行を検索 | ステータスが「未処理」の行 |
| **列値一覧** | 特定列の値リスト取得 | 部署名の一覧取得 |
| **行データ取得** | 指定行のデータ取得 | 5行目のデータ取得 |
| **セル更新** | セル値を更新 | ステータスを「完了」に更新 |
| **行追加** | 新しい行を追加 | 集計結果の行を追加 |
| **行削除** | 指定行を削除 | エラーデータの削除 |
| **配列ソート** | データを並び替え | 日付順にソート |
| **配列フィルタ** | 条件でフィルタリング | 金額10万円以上のみ抽出 |
| **列追加** | 新しい列を追加 | 計算結果列を追加 |
| **データ件数** | 行数・列数を取得 | 処理対象件数の確認 |
| **重複削除** | 重複行を削除 | データクリーニング |

### 4.9 ウインドウ操作（9ノード）

アプリケーションウインドウを制御します。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **ウインドウ存在確認** | ウインドウの有無確認 | 対象アプリが起動しているか |
| **ウインドウ待機** | ウインドウ出現を待つ | ダイアログ表示まで待機 |
| **アクティブ化** | ウインドウを前面に | 操作対象をアクティブに |
| **最大化** | ウインドウを最大化 | 作業領域を広げる |
| **最小化** | ウインドウを最小化 | バックグラウンドへ |
| **通常化** | ウインドウを通常サイズに | サイズをリセット |
| **ウインドウを閉じる** | ウインドウを閉じる | アプリ終了 |
| **ウインドウ情報取得** | 位置・サイズ取得 | ウインドウ状態の確認 |
| **移動・サイズ変更** | ウインドウの配置調整 | 複数ウインドウの整列 |

### 4.10 画像処理（6ノード）

画像認識による自動操作を行います。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **画像マッチング移動** | 画像を探してマウス移動 | 特定ボタン画像の位置へ |
| **画像マッチングクリック** | 画像を探してクリック | アイコン画像をクリック |
| **画像待機** | 画像が表示されるまで待機 | ローディング完了待ち |
| **画像存在確認** | 画像の有無で分岐 | エラー画像が出ているか |
| **スクリーンショット保存** | 画面全体を保存 | エビデンス取得 |
| **ウィンドウSS** | 特定ウインドウを保存 | 処理結果の記録 |

### 4.11 ファイル操作（10ノード）

ファイル・フォルダ操作を行います。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **ファイルコピー** | ファイルを複製 | バックアップ作成 |
| **ファイル移動** | ファイルを移動 | 処理済みフォルダへ移動 |
| **ファイル削除** | ファイルを削除 | 一時ファイルの削除 |
| **ファイル存在確認** | ファイルの有無確認 | 入力ファイルの確認 |
| **フォルダ作成** | フォルダを作成 | 出力先フォルダの準備 |
| **ファイル一覧** | フォルダ内ファイル取得 | 処理対象ファイルの列挙 |
| **テキスト読込** | テキストファイル読込 | 設定ファイルの読み込み |
| **テキスト書込** | テキストファイル書込 | ログファイルの出力 |
| **ファイル名変更** | ファイル名を変更 | 日付付きファイル名に |
| **パス結合** | パス文字列を結合 | フォルダ+ファイル名 |

### 4.12 共通処理（5ノード）

汎用的な処理を行います。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **指定時間待機** | 指定秒数待機 | 画面読み込み待ち |
| **ランダム待機** | ランダム時間待機 | 人間らしい操作間隔 |
| **ログ出力** | ログファイルに出力 | 処理履歴の記録 |
| **コメント** | 処理内容のメモ | フローの説明 |
| **処理中断** | 処理を中断 | エラー時の停止 |

### 4.13 Excel(操作)（16ノード）

Excelのセル単位で細かい操作を行います。**書式設定やシート管理に最適**です。

| ノード名 | 機能説明 | 利用例 |
|---------|---------|--------|
| **セル値取得** | 特定セルの値を取得 | A1セルの読み取り |
| **セル値設定** | 特定セルに値を設定 | B5セルに値を入力 |
| **背景色設定** | セルの背景色を設定 | エラー行を赤色に |
| **フォント色設定** | 文字色を設定 | 金額をマイナスなら赤字 |
| **フォント太字** | 太字の設定 | 見出し行を強調 |
| **フォントサイズ** | 文字サイズ設定 | タイトルを大きく |
| **罫線設定** | 罫線を設定 | 表の枠線を引く |
| **数式設定** | 計算式を設定 | SUM関数の設定 |
| **シート追加** | 新しいシート追加 | 月別シートの作成 |
| **シート削除** | シートを削除 | 不要シートの削除 |
| **シート名変更** | シート名を変更 | 日付入りシート名に |
| **範囲クリア** | 範囲をクリア | データ領域の初期化 |
| **最終行取得** | データ最終行を取得 | データ範囲の把握 |
| **最終列取得** | データ最終列を取得 | データ範囲の把握 |
| **行挿入/削除** | 行の挿入・削除 | 集計行の挿入 |
| **列幅自動調整** | 列幅を自動調整 | 見やすい表示に |
| **シート一覧取得** | シート名一覧取得 | 処理対象シートの確認 |

---

## 5. ワークフローエディタ機能

### 5.1 レイヤーシステム（7階層）

複雑な処理を階層的に整理できます。

```
レイヤー1: メイン作業領域（常時表示）
レイヤー2: サブ領域
レイヤー3〜7: 深い階層用
```

**特徴:**
- ドリルダウン方式で複雑な処理を階層化
- スライド移動アニメーションで視覚的に理解しやすい
- サブルーチン化した処理を別レイヤーで詳細表示

### 5.2 ノード配置・管理

| 操作 | 方法 |
|------|------|
| **ノード追加** | 左パレットからドラッグ＆ドロップ |
| **ノード編集** | クリックして設定ダイアログを開く |
| **ノード移動** | ドラッグで再配置（自動整列対応） |
| **ノード削除** | 右クリック → 削除 |

### 5.3 ネスト規制（自動バリデーション）

誤ったコード生成を防止するため、以下の配置を自動でブロックします：

- ループ内に条件分岐を配置 → **禁止**
- 条件分岐内にループを配置 → **禁止**
- 既存の制御構造範囲をまたぐ移動 → **禁止**

### 5.4 スクリプト化（サブルーチン）

複数のノードをまとめて再利用可能にします。

**操作手順:**
1. SHIFTキー + 複数ノードをクリック（選択）
2. 右クリック → 「レイヤー化」
3. 選択したノードがピンク色のスクリプトノードに変化
4. ピンクノードをクリック → 詳細を別レイヤーで表示

**用途例:** 「ログイン処理」「エラーハンドリング」など繰り返し使う処理をモジュール化

### 5.5 Undo/Redo機能

| 機能 | 説明 |
|------|------|
| **Undo** | 直前の操作を取り消し（最大50件） |
| **Redo** | 取り消した操作をやり直し |
| **スナップショット** | 現在の状態を保存して後で復元可能 |

### 5.6 フロー可視化

- **パネル内矢印**: ノード間を垂直矢印で接続
- **条件分岐矢印**: if/else分岐を異なる色で表示
- **ループ矢印**: ループバック矢印で繰り返しを表現
- **クロスパネル矢印**: レイヤー間の接続をグラデーション表示

---

## 6. 自動化可能な業務領域

### 6.1 業務適用マトリクス

| 業務領域 | 対応状況 | 主な自動化内容 |
|---------|---------|---------------|
| **総務・事務** | ◎ 完全対応 | 請求書発行、従業員情報登録、経費申請 |
| **営業支援** | ◎ 完全対応 | リード自動分類、案件登録、レポート生成 |
| **在庫管理** | ◎ 完全対応 | 在庫確認、発注自動化、出荷伝票生成 |
| **財務・会計** | ◎ 完全対応 | 仕訳自動作成、決算資料集計、税務申告準備 |
| **人事・給与** | ◎ 完全対応 | 勤務時間集計、給与計算連携、異動手続き |
| **営業報告** | ◎ 完全対応 | 日報自動集約、営業成績集計、ダッシュボード |

### 6.2 典型的なワークフロー例

#### 例1: Excel → Webシステム自動転記

```
1. Excelファイルを読み込み
   └─ 2次元配列で一括読込（高速処理）

2. データ検証・加工
   ├─ 条件検索: 特定条件のみ抽出
   ├─ ソート: 名前順・日付順に整列
   └─ フィルタ: 不要なデータ削除

3. Webシステムへ自動転記
   ├─ ブラウザ自動操作
   ├─ テキスト入力（高速貼付対応）
   ├─ ボタンクリック（座標/画像マッチング）
   └─ フォーム送信

4. 結果をExcelに記録
   ├─ セル値設定
   ├─ 背景色・フォント指定
   └─ Excelファイル保存
```

#### 例2: 複合条件処理

```
【外側ループ】Excelの各行でループ
  ├─ 【条件分岐1】ステータスが "未処理" ?
  │   ├─ True: 【内側ループ】リトライ3回
  │   │        └─ Webシステムで追加入力
  │   └─ False: スキップ
  │
  └─ 【条件分岐2】結果が "エラー" ?
       ├─ True: 管理者に通知
       └─ False: 完了ログ出力
```

### 6.3 導入効果の目安

| 処理内容 | 手作業時間 | 自動化後 | 削減率 |
|---------|-----------|---------|-------|
| 100件のデータ転記 | 2時間 | 5分 | 96% |
| 日次レポート集計 | 30分 | 2分 | 93% |
| ファイル整理（50件） | 1時間 | 3分 | 95% |
| 複数システム間連携 | 3時間 | 10分 | 94% |

---

## 7. システム構成・技術仕様

### 7.1 動作環境

| 項目 | 要件 |
|------|------|
| **OS** | Windows 10 / 11 |
| **PowerShell** | 5.1以上（7.x推奨） |
| **ブラウザ** | Chrome / Edge / Firefox |
| **必須モジュール** | Pode 2.11.0（自動インストール） |
| **ポート** | 8080（変更可能） |

### 7.2 アーキテクチャ

```
┌─────────────────────────────────────────────────────┐
│              ブラウザ（React Flow UI）              │
│         http://localhost:8080/index-legacy.html     │
└──────────────────────┬──────────────────────────────┘
                       │ REST API
┌──────────────────────▼──────────────────────────────┐
│              Pode HTTPサーバー                       │
│           adapter/api-server-v2-pode-complete.ps1   │
│                  （50エンドポイント）                 │
└──────────────────────┬──────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────┐
│              ビジネスロジック層                       │
│         v2関数群（ノード管理、コード生成）            │
└──────────────────────┬──────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────┐
│              実行エンジン                            │
│    PowerShellスクリプト + win32API.psm1             │
└─────────────────────────────────────────────────────┘
```

### 7.3 データ保存形式

| データ種別 | 保存先 | 形式 |
|-----------|-------|------|
| ノード配置 | 03_history/{プロジェクト}/memory.json | JSON |
| 生成コード | 03_history/{プロジェクト}/コード.json | JSON |
| 変数定義 | 03_history/{プロジェクト}/variables.json | JSON |
| 操作履歴 | 03_history/{プロジェクト}/history.json | JSON |

---

## 8. 導入・セットアップ

### 8.1 クイックスタート

```powershell
# 1. リポジトリをクローン
git clone https://github.com/kotanono0607/UIpowershell.git
cd UIpowershell

# 2. クイックスタート実行
.\quick-start.ps1
```

**自動実行内容:**
- 必須ファイルの確認
- Podeモジュールの自動インストール
- ポート使用状況の確認
- ブラウザの自動起動

### 8.2 アクセス

```
URL: http://localhost:8080/index-legacy.html
```

### 8.3 基本操作フロー

1. **プロジェクト作成**: 新規プロジェクトを作成
2. **ノード配置**: 左パレットからノードをドラッグ＆ドロップ
3. **パラメータ設定**: 各ノードをクリックして詳細設定
4. **コード生成**: 「生成」ボタンでPowerShellスクリプト生成
5. **実行**: 「実行」ボタンで自動処理開始

---

## お問い合わせ

本ドキュメントに関するご質問は、開発チームまでお問い合わせください。

---

*最終更新: 2025年12月*
