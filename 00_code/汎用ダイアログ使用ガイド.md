# 汎用ダイアログ使用ガイド

## 概要

`13_コードサブ汎用関数.ps1` には、ノード機能で使用できる汎用ダイアログ関数が定義されています。
これらの関数を使用することで、ユーザー入力を受け取るダイアログを簡単に実装できます。

## 汎用ダイアログ関数一覧

### 1. リストから項目を選択

ドロップダウンリスト（ComboBox）から項目を選択するダイアログを表示します。

**パラメータ:**
- `フォームタイトル` (必須): ダイアログのタイトル
- `ラベルテキスト` (必須): ユーザーに表示する説明文
- `選択肢リスト` (必須): 選択肢の配列

**戻り値:**
- 選択された項目（文字列）
- キャンセル時は `$null`

**使用例:**
```powershell
# 例1: キーコマンドの選択
$キーコマンドリスト = @("Ctrl+A", "Ctrl+C", "Ctrl+V", "Ctrl+F", "Alt+F4", "Del", "Enter", "Tab", "Shift+Tab", "PageUp", "PageDown", "ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight", "Esc")
$選択された項目 = リストから項目を選択 -フォームタイトル "キーコマンドの選択" -ラベルテキスト "キーコマンドを選択してください:" -選択肢リスト $キーコマンドリスト

# 例2: ウインドウの選択
$ウインドウリスト = 開いているウインドウタイトル取得
$選択された項目 = リストから項目を選択 -フォームタイトル "ウインドウの選択" -ラベルテキスト "対象のウインドウを選択してください:" -選択肢リスト $ウインドウリスト

# 例3: ファイル形式の選択
$形式リスト = @("CSV", "JSON", "XML", "Excel")
$選択された形式 = リストから項目を選択 -フォームタイトル "保存形式の選択" -ラベルテキスト "ファイル形式を選択してください:" -選択肢リスト $形式リスト
```

---

### 2. 文字列を入力

テキストボックスで文字列を入力するダイアログを表示します。

**パラメータ:**
- `フォームタイトル` (必須): ダイアログのタイトル
- `ラベルテキスト` (必須): ユーザーに表示する説明文

**戻り値:**
- 入力された文字列（トリム済み）
- 空欄またはキャンセル時は `$null`

**特殊機能:**
- 「変数を使用」ボタンで変数管理システムから変数を挿入可能

**使用例:**
```powershell
# 例1: アプリケーションパスの入力
$入力された文字列 = 文字列を入力 -フォームタイトル "アプリのパス入力" -ラベルテキスト "アプリのパスを入力してください:"

# 例2: ファイル名の入力
$ファイル名 = 文字列を入力 -フォームタイトル "ファイル名の入力" -ラベルテキスト "保存するファイル名を入力してください:"

# 例3: 検索キーワードの入力
$キーワード = 文字列を入力 -フォームタイトル "検索キーワード" -ラベルテキスト "検索したいキーワードを入力してください:"
```

---

### 3. 数値を入力

数値入力用コントロール（NumericUpDown）で数値を入力するダイアログを表示します。

**パラメータ:**
- `フォームタイトル` (必須): ダイアログのタイトル
- `ラベルテキスト` (必須): ユーザーに表示する説明文

**戻り値:**
- 入力された数値（整数）
- キャンセル時は `$null`

**使用例:**
```powershell
# 例1: 待機秒数の入力
$入力された数値 = 数値を入力 -フォームタイトル "待機秒数の入力" -ラベルテキスト "待機する秒数を入力してください:"

# 例2: リトライ回数の入力
$リトライ回数 = 数値を入力 -フォームタイトル "リトライ回数" -ラベルテキスト "リトライ回数を入力してください:"

# 例3: 繰り返し回数の入力
$繰り返し回数 = 数値を入力 -フォームタイトル "繰り返し回数" -ラベルテキスト "処理を繰り返す回数を入力してください:"
```

---

### 4. キー操作

指定したキーコマンドをキーボード入力として送信します（RPA実行用）。

**パラメータ:**
- `キーコマンド` (必須): 送信するキーコマンド

**対応キーコマンド:**
- `Ctrl+A`, `Ctrl+C`, `Ctrl+V`, `Ctrl+F`
- `Alt+F4`
- `Del`, `Enter`, `Tab`, `Shift+Tab`
- `PageUp`, `PageDown`
- `ArrowUp`, `ArrowDown`, `ArrowLeft`, `ArrowRight`
- `Esc`

**使用例:**
```powershell
# キーコマンドを選択させて実行
$キーコマンドリスト = @("Ctrl+A", "Ctrl+C", "Ctrl+V", "Enter")
$選択された項目 = リストから項目を選択 -フォームタイトル "キーコマンドの選択" -ラベルテキスト "キーコマンドを選択してください:" -選択肢リスト $キーコマンドリスト
キー操作 -キーコマンド $選択された項目
```

---

### 5. 文字列入力

指定した文字列をキーボード入力として送信します（RPA実行用）。

**パラメータ:**
- `入力文字列` (必須): 送信する文字列

**使用例:**
```powershell
# 文字列を入力させて送信
$入力された文字列 = 文字列を入力 -フォームタイトル "文字列の入力" -ラベルテキスト "入力したい文字列を入力してください:"
文字列入力 -入力文字列 $入力された文字列
```

---

## 実装パターン

### 基本パターン: ダイアログ → 処理

```powershell
function X_Y {
@'
# ダイアログで入力を受け取る
$入力値 = 汎用ダイアログ関数 -フォームタイトル "タイトル" -ラベルテキスト "説明文" -その他パラメータ

# 入力値を使って処理を実行
処理関数 -パラメータ $入力値
'@
}
```

### 実例: 3-1.ps1（キー操作）

```powershell
function 3_1 {
@'
$キーコマンドリスト = @("Ctrl+A", "Ctrl+C", "Ctrl+V", "Ctrl+F", "Alt+F4", "Del", "Enter", "Tab", "Shift+Tab", "PageUp", "PageDown", "ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight", "Esc")
$選択された項目 = リストから項目を選択 -フォームタイトル "キーコマンドの選択" -ラベルテキスト "キーコマンドを選択してください:" -選択肢リスト $キーコマンドリスト
キー操作 -キーコマンド $選択された項目
'@
}
```

### 実例: 5-1.ps1（アプリ起動）

```powershell
function 5_1 {
@'
$入力された文字列 = 文字列を入力 -フォームタイトル "文字列の入力" -ラベルテキスト "アプリのパスを入力してください:"
指定アプリ起動 -パス $入力された文字列
'@
}
```

### 実例: 1-8.ps1（待機）

```powershell
function 1_8 {
@'
$入力された数値 = 数値を入力 -フォームタイトル "数値の入力" -ラベルテキスト "入力したい数値を入力してください:"
指定秒待機 -秒数 $入力された数値
'@
}
```

---

## ベストプラクティス

### 1. パラメータは用途に合わせて適切に設定する

❌ **悪い例:**
```powershell
# ウインドウ選択なのにキーコマンドのタイトル
$選択された項目 = リストから項目を選択 -フォームタイトル "キーコマンドの選択" -ラベルテキスト "キーコマンドを選択してください:" -選択肢リスト $ウインドウリスト
```

✅ **良い例:**
```powershell
# 用途に合った適切なタイトルとラベル
$選択された項目 = リストから項目を選択 -フォームタイトル "ウインドウの選択" -ラベルテキスト "対象のウインドウを選択してください:" -選択肢リスト $ウインドウリスト
```

### 2. シングルクォートのhere-stringを使用する

変数展開を防ぐため、必ずシングルクォート (`@'...'@`) を使用してください。

✅ **推奨:**
```powershell
function X_Y {
@'
$変数 = リストから項目を選択 -フォームタイトル "タイトル" -ラベルテキスト "説明文" -選択肢リスト $リスト
処理 -パラメータ $変数
'@
}
```

❌ **非推奨:**
```powershell
function X_Y {
@"
$変数 = リストから項目を選択 -フォームタイトル "タイトル" -ラベルテキスト "説明文" -選択肢リスト $リスト
処理 -パラメータ $変数
"@
}
```

### 3. 選択肢は分かりやすく具体的に

✅ **良い例:**
```powershell
$形式リスト = @("CSV形式 (.csv)", "JSON形式 (.json)", "XML形式 (.xml)", "Excel形式 (.xlsx)")
```

❌ **悪い例:**
```powershell
$形式リスト = @("1", "2", "3", "4")  # 何を意味するか不明
```

### 4. ラベルテキストには具体的な指示を含める

✅ **良い例:**
```powershell
-ラベルテキスト "処理を実行するウインドウを選択してください:"
-ラベルテキスト "待機する秒数を入力してください（1-3600）:"
```

❌ **悪い例:**
```powershell
-ラベルテキスト "選択"
-ラベルテキスト "入力"
```

---

## よくある質問

### Q1: 汎用関数が見つからないエラーが出る

A: サーバーが起動していること、および `13_コードサブ汎用関数.ps1` が存在することを確認してください。
ノード実行時に自動的に読み込まれます。

### Q2: ダイアログが表示されない

A: 以下を確認してください：
1. サーバーが最新のコードで起動されているか
2. ノード設定ダイアログの「実行」ボタンをクリックしているか
3. ログに「汎用関数を読み込みました」が表示されているか

### Q3: 新しい汎用関数を追加したい

A: `13_コードサブ汎用関数.ps1` に新しい関数を追加し、このガイドにも使用方法を追記してください。

---

## まとめ

汎用ダイアログ関数を活用することで：
- ✅ コードの重複を減らせる
- ✅ 一貫したUIを提供できる
- ✅ 開発時間を短縮できる
- ✅ メンテナンスが容易になる

新しいノード機能を追加する際は、既存の汎用関数を活用することを検討してください。
