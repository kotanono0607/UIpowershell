# スクリプト化とレイヤー管理 - テストケース

**作成日**: 2025-11-01
**対象修正**: 問題#1, #2, #3（フェーズ1+2）

---

## 🎯 テストの目的

以下の問題が修正されたことを確認する：
- **問題#1**: 右矢印でスクリプト展開状態が失われる
- **問題#2**: Pink選択配列の状態管理の不整合
- **問題#3**: 階層パス表示の「[不明]」

---

## ✅ テスト1: Pink選択配列のリセット（問題#1, #2）

### テスト1-1: 右矢印でのリセット確認

**手順**:
1. アプリケーションを起動
2. レイヤー1で複数のノードを配置（SHIFT+クリック）
3. 「レイヤー化」ボタンをクリックしてスクリプト化ノードを作成
4. スクリプト化ノードをクリック
   - 期待結果: レイヤー2にノードが展開される
5. **右矢印**を押してレイヤー1に戻る
   - 期待結果:
     - コンソールに「レイヤー2 をクリア」と表示される
     - コンソールに「→ Pink選択配列[1] をリセット」と表示される
6. 再度**左矢印**を押す
   - 期待結果:
     - 「スクリプト展開が必要です」というエラーダイアログが表示される
     - レイヤー2には進めない

**修正前の動作**:
- 手順6で、エラーが表示されずレイヤー2に進んでしまう（空のレイヤー）

**確認ポイント**:
- [ ] 手順5でコンソールに「Pink選択配列[1] をリセット」と表示される
- [ ] 手順6でエラーダイアログが表示される

---

### テスト1-2: 左矢印でのリセット確認

**手順**:
1. アプリケーションを起動
2. レイヤー1でスクリプト化ノードを作成・展開してレイヤー2を表示
3. レイヤー2でさらにスクリプト化ノードを作成・展開してレイヤー3を表示
4. **右矢印**を2回押してレイヤー1に戻る
   - 期待結果:
     - コンソールに「レイヤー2 をクリア」「レイヤー3 をクリア」と表示
     - コンソールに「Pink選択配列[1] をリセット」「Pink選択配列[2] をリセット」と表示
5. **左矢印**を押す
   - 期待結果: レイヤー2に進む（OK）
6. さらに**左矢印**を押す
   - 期待結果:
     - 「スクリプト展開が必要です」エラーが表示される
     - レイヤー3には進めない

**確認ポイント**:
- [ ] 手順4でコンソールに「Pink選択配列[2] をリセット」と表示される
- [ ] 手順6でエラーダイアログが表示される

---

### テスト1-3: 往復操作のテスト（重要）

**手順**:
1. レイヤー1でスクリプト化ノードを作成・展開してレイヤー2を表示
2. レイヤー2にノードを配置（例: 3個のノード）
3. **右矢印**でレイヤー1に戻る
   - 確認: レイヤー2がクリアされる
4. 再度レイヤー1でスクリプト化ノードをクリック
   - 期待結果: レイヤー2に再展開される（新しい空の状態）
5. レイヤー2にノードを配置（例: 2個のノード）
6. **右矢印**でレイヤー1に戻る
7. 再度レイヤー1でスクリプト化ノードをクリック
   - 期待結果: レイヤー2に再々展開される（手順5のノードは消えている）

**確認ポイント**:
- [ ] 手順7で、手順5で配置したノードは消えている（クリーンな再展開）

---

## ✅ テスト2: 階層パス表示の修正（問題#3）

### テスト2-1: 初期状態の階層パス表示

**手順**:
1. アプリケーションを起動
2. 画面下部の階層パス表示を確認

**期待結果**:
```
📍 階層パス: レイヤー0 → レイヤー1
```

**修正前の動作**:
```
📍 階層パス: レイヤー0 → [不明] → レイヤー1
```

**確認ポイント**:
- [ ] 階層パス表示に「[不明]」が表示されない

---

### テスト2-2: スクリプト展開後の階層パス表示

**手順**:
1. レイヤー1でスクリプト化ノード「112-1」を作成
2. スクリプト化ノードをクリックしてレイヤー2を展開
3. 画面下部の階層パス表示を確認

**期待結果**:
```
📍 階層パス: レイヤー0 → レイヤー1 → 112-1 → レイヤー2
```

**確認ポイント**:
- [ ] スクリプト化ノードの名前（例: 112-1）が正しく表示される

---

### テスト2-3: 多階層の階層パス表示

**手順**:
1. レイヤー1でスクリプト化ノード「112-1」を展開 → レイヤー2
2. レイヤー2でスクリプト化ノード「115-1」を展開 → レイヤー3
3. 画面下部の階層パス表示を確認

**期待結果**:
```
📍 階層パス: レイヤー0 → レイヤー1 → 112-1 → レイヤー2 → 115-1 → レイヤー3
```

**確認ポイント**:
- [ ] 各レイヤーの展開ボタン名が正しく表示される
- [ ] 「[不明]」が表示されない

---

### テスト2-4: 右矢印で戻った後の階層パス表示

**手順**:
1. テスト2-3の続き（レイヤー3を表示中）
2. **右矢印**を1回押してレイヤー2に戻る
3. 階層パス表示を確認

**期待結果**:
```
📍 階層パス: レイヤー0 → レイヤー1 → 112-1 → レイヤー2
```

**確認ポイント**:
- [ ] レイヤー3への遷移（115-1）が表示から消える

---

## ✅ テスト3: 統合テスト（問題#1, #2, #3）

### テスト3-1: フル操作シナリオ

**手順**:
1. アプリケーションを起動
   - 確認: 階層パス = `レイヤー0 → レイヤー1`
2. レイヤー1でノードを3個配置
3. SHIFT+クリックで3個選択して「レイヤー化」
   - スクリプト化ノード「112-1」が作成される
4. 「112-1」をクリック
   - レイヤー2に展開
   - 確認: 階層パス = `レイヤー0 → レイヤー1 → 112-1 → レイヤー2`
5. レイヤー2でノードを2個配置
6. **右矢印**でレイヤー1に戻る
   - 確認: コンソールに「Pink選択配列[1] をリセット」
   - 確認: 階層パス = `レイヤー0 → レイヤー1`
7. **左矢印**を押す
   - 期待結果: エラーダイアログ「スクリプト展開が必要です」
8. 再度「112-1」をクリック
   - レイヤー2に再展開
   - 確認: レイヤー2は空（手順5のノードは消えている）
9. レイヤー2でノードを1個配置
10. **右矢印**→**左矢印**
    - 期待結果: エラーダイアログ

**確認ポイント**:
- [ ] 各ステップで階層パス表示が正しく更新される
- [ ] Pink選択配列のリセットが正しく動作する
- [ ] レイヤークリア後の再展開が正しく動作する

---

## 📝 テスト結果記録

### テスト実施日: _______________
### テスト実施者: _______________

| テストケース | 結果 | 備考 |
|------------|------|------|
| テスト1-1 | ⬜ Pass / ⬜ Fail | |
| テスト1-2 | ⬜ Pass / ⬜ Fail | |
| テスト1-3 | ⬜ Pass / ⬜ Fail | |
| テスト2-1 | ⬜ Pass / ⬜ Fail | |
| テスト2-2 | ⬜ Pass / ⬜ Fail | |
| テスト2-3 | ⬜ Pass / ⬜ Fail | |
| テスト2-4 | ⬜ Pass / ⬜ Fail | |
| テスト3-1 | ⬜ Pass / ⬜ Fail | |

---

## 🐛 バグ発見時の対応

もしテストで問題が見つかった場合：
1. **コンソール出力をコピー**（Write-Hostの出力）
2. **スクリーンショット**を撮影
3. **再現手順**を記録
4. 私（Claude）に報告

修正は私が担当します。

---

## ✅ テスト完了後の確認

すべてのテストがPassした場合：
- [ ] コンソール出力に「Pink選択配列をリセット」が正しく表示される
- [ ] 階層パス表示に「[不明]」が表示されない
- [ ] 往復操作が正しく動作する
- [ ] エラーダイアログが適切なタイミングで表示される

---

**次のステップ**: テスト完了後、問題管理ドキュメントを更新して修正完了を記録します。
