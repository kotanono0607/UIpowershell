<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIpowershell - Visual RPA Platform (3ペイン構成)</title>
    <link rel="stylesheet" href="style-legacy.css">
</head>
<body>
    <!-- ヘッダー: 40px -->
    <div id="header">
        <!-- メニューバー -->
        <div id="menubar">
            <div class="menu-item" style="font-weight: bold; color: #007acc; cursor: default;">UIpowershell <span id="app-version" style="font-size: 0.85em; color: #666;">v1.0.154</span></div>
            <div class="menu-item" onclick="executeCode()">実行</div>
            <div class="menu-item" onclick="openVariableModal()">変数</div>
            <div class="menu-item" onclick="createFolder()">フォルダ作成</div>
            <div class="menu-item" onclick="switchFolder()">フォルダ切替</div>
            <div class="menu-item" onclick="createSnapshot()">📸 スナップショット</div>
            <div class="menu-item" onclick="restoreSnapshot()">↩️ 復元</div>
        </div>

        <!-- ツールバー -->
        <div id="toolbar">
            <button onclick="deleteAllNodes()" class="btn-danger">全削除</button>
            <button onclick="navigateLayer('left')" class="btn-nav">◀</button>
            <span id="current-layer-label">レイヤー1</span>
            <button onclick="navigateLayer('right')" class="btn-nav">▶</button>
        </div>
    </div>

    <!-- 右ペイン折りたたみボタン -->
    <button id="right-panel-toggle" onclick="toggleRightPanel()">◀</button>

    <!-- メインコンテナ: 3ペイン構成 -->
    <div id="main-container">
        <!-- 左側：操作パネル（10カテゴリー切り替え） -->
        <div id="left-panel">
            <!-- カテゴリー切り替えボタン -->
            <div id="category-buttons">
                <button onclick="switchCategory(1)" class="category-btn" style="background-color: rgb(180, 180, 180);">制御構文</button>
                <button onclick="switchCategory(2)" class="category-btn" style="background-color: rgb(250, 215, 220);">マウス操作</button>
                <button onclick="switchCategory(3)" class="category-btn" style="background-color: rgb(210, 255, 240);">キーボード操作</button>
                <button onclick="switchCategory(4)" class="category-btn" style="background-color: rgb(225, 245, 230);">UIAutomation</button>
                <button onclick="switchCategory(5)" class="category-btn" style="background-color: rgb(250, 250, 230);">ファイル操作</button>
                <button onclick="switchCategory(6)" class="category-btn" style="background-color: rgb(240, 230, 250);">データ処理</button>
                <button onclick="switchCategory(7)" class="category-btn" style="background-color: rgb(245, 245, 245);">スクリプト実行</button>
                <button onclick="switchCategory(8)" class="category-btn" style="background-color: rgb(220, 235, 255);">Excel処理</button>
                <button onclick="switchCategory(9)" class="category-btn" style="background-color: rgb(255, 250, 220);">ウインドウ操作</button>
                <button onclick="switchCategory(10)" class="category-btn" style="background-color: rgb(255, 235, 240);">画像処理</button>
            </div>

            <!-- ノード追加ボタンパネル（カテゴリーごとに切り替わる） -->
            <div id="node-buttons-container">
                <!-- カテゴリー1：制御構文 -->
                <div id="category-panel-1" class="category-panel active">
                    <!-- ボタン設定.jsonから動的に生成 -->
                </div>
                <!-- カテゴリー2：マウス操作 -->
                <div id="category-panel-2" class="category-panel">
                    <!-- ボタン設定.jsonから動的に生成 -->
                </div>
                <!-- カテゴリー3-10も同様 -->
                <div id="category-panel-3" class="category-panel"></div>
                <div id="category-panel-4" class="category-panel"></div>
                <div id="category-panel-5" class="category-panel"></div>
                <div id="category-panel-6" class="category-panel"></div>
                <div id="category-panel-7" class="category-panel"></div>
                <div id="category-panel-8" class="category-panel"></div>
                <div id="category-panel-9" class="category-panel"></div>
                <div id="category-panel-10" class="category-panel"></div>
            </div>
        </div>

        <!-- 中央：左右2パネル表示（PowerShell互換） -->
        <div id="center-container">
            <!-- 左パネル -->
            <div id="left-layer-panel" class="dual-layer-panel">
                <div id="layer-0" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー0</div>
                    <div class="node-list-container">
                        <!-- ノードが縦に並ぶ -->
                    </div>
                </div>
                <div id="layer-1" class="layer-panel" style="display: block;">
                    <div class="layer-label">レイヤー1</div>
                    <div class="node-list-container">
                        <!-- ノードが縦に並ぶ -->
                    </div>
                </div>
                <div id="layer-2" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー2</div>
                    <div class="node-list-container">
                        <!-- ノードが縦に並ぶ -->
                    </div>
                </div>
                <div id="layer-3" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー3</div>
                    <div class="node-list-container"></div>
                </div>
                <div id="layer-4" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー4</div>
                    <div class="node-list-container"></div>
                </div>
                <div id="layer-5" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー5</div>
                    <div class="node-list-container"></div>
                </div>
                <div id="layer-6" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー6</div>
                    <div class="node-list-container"></div>
                </div>
            </div>

            <!-- 右パネル -->
            <div id="right-layer-panel" class="dual-layer-panel">
                <div id="layer-0-right" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー0</div>
                    <div class="node-list-container"></div>
                </div>
                <div id="layer-1-right" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー1</div>
                    <div class="node-list-container"></div>
                </div>
                <div id="layer-2-right" class="layer-panel" style="display: block;">
                    <div class="layer-label">レイヤー2</div>
                    <div class="node-list-container">
                        <!-- ノードが縦に並ぶ -->
                    </div>
                </div>
                <div id="layer-3-right" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー3</div>
                    <div class="node-list-container"></div>
                </div>
                <div id="layer-4-right" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー4</div>
                    <div class="node-list-container"></div>
                </div>
                <div id="layer-5-right" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー5</div>
                    <div class="node-list-container"></div>
                </div>
                <div id="layer-6-right" class="layer-panel" style="display: none;">
                    <div class="layer-label">レイヤー6</div>
                    <div class="node-list-container"></div>
                </div>
            </div>
        </div>

        <!-- 右ペイン: 320px固定（折りたたみ可） -->
        <div id="right-panel">
            <!-- 説明エリア -->
            <div id="description-panel">
                <div class="panel-label">説明</div>
                <div id="description-text">ここに説明文が表示されます。</div>
            </div>

            <!-- プレビューエリア -->
            <div class="panel-label">プレビュー</div>
            <div id="preview-content">
                <!-- 右側のレイヤーのプレビュー -->
            </div>
        </div>
    </div>

    <!-- フッター: 28px -->
    <div id="hierarchy-path">
        📍 階層パス: <span id="path-text">レイヤー1</span>
    </div>

    <!-- 右クリックメニュー -->
    <div id="context-menu" class="context-menu">
        <div class="context-menu-item" onclick="renameNode()">名前変更</div>
        <div class="context-menu-item" onclick="editScript()">スクリプト編集</div>
        <div class="context-menu-item" onclick="executeScript()">スクリプト実行</div>
        <div class="context-menu-item" onclick="toggleRedBorder()">赤枠トグル</div>
        <div class="context-menu-item" onclick="applyRedBorderToGroup()">赤枠グループ適用</div>
        <div class="context-menu-item" onclick="layerizeNode()">レイヤー化</div>
        <div class="context-menu-item" onclick="deleteNode()">削除</div>
    </div>

    <!-- 変数管理モーダル -->
    <div id="variable-modal" class="modal">
        <div class="modal-content">
            <h2>変数管理</h2>
            <button class="modal-close" onclick="closeVariableModal()">×</button>
            <div class="modal-body">
                <button onclick="addVariablePrompt()">➕ 新しい変数を追加</button>
                <table id="variable-table">
                    <thead>
                        <tr>
                            <th>変数名</th>
                            <th>値</th>
                            <th>タイプ</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="variable-list">
                        <!-- 変数がここに表示される -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- フォルダ切替モーダル -->
    <div id="folder-modal" class="modal">
        <div class="modal-content">
            <h2>フォルダ切替</h2>
            <button class="modal-close" onclick="closeFolderModal()">×</button>
            <div class="modal-body">
                <select id="folder-select" size="10">
                    <!-- フォルダ一覧が表示される -->
                </select>
                <button onclick="selectFolder()">選択</button>
            </div>
        </div>
    </div>

    <!-- スクリプト編集モーダル -->
    <div id="script-modal" class="modal">
        <div class="modal-content" style="width: 80%; max-width: 800px;">
            <h2>スクリプト編集: <span id="script-node-name"></span></h2>
            <button class="modal-close" onclick="closeScriptModal()">×</button>
            <div class="modal-body">
                <textarea id="script-editor" rows="20" style="width: 100%; font-family: 'Consolas', 'Courier New', monospace; font-size: 14px;"></textarea>
                <div style="margin-top: 10px;">
                    <button onclick="saveScript()">💾 保存</button>
                    <button onclick="closeScriptModal()">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ノード詳細設定モーダル -->
    <div id="node-settings-modal" class="modal">
        <div class="modal-content" style="width: 70%; max-width: 700px;">
            <h2>ノード設定: <span id="settings-node-name"></span></h2>
            <button class="modal-close" onclick="closeNodeSettingsModal()">×</button>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <label>ノード名:</label>
                    <input type="text" id="settings-node-text" style="width: 100%; padding: 5px;" />
                </div>
                <div id="settings-custom-fields">
                    <!-- 処理番号に応じたカスタムフィールドがここに表示される -->
                </div>
                <div style="margin-top: 15px;">
                    <label>スクリプト:</label>
                    <textarea id="settings-node-script" rows="10" style="width: 100%; font-family: 'Consolas', 'Courier New', monospace; font-size: 12px;"></textarea>
                </div>
                <div style="margin-top: 15px;">
                    <button onclick="saveNodeSettings()">💾 保存</button>
                    <button onclick="closeNodeSettingsModal()">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- コード生成結果モーダル -->
    <div id="code-result-modal" class="modal">
        <div class="modal-content" style="width: 80%; max-width: 900px;">
            <h2>✅ コード生成完了</h2>
            <button class="modal-close" onclick="closeCodeResultModal()">×</button>
            <div class="modal-body">
                <div id="code-result-info" style="margin-bottom: 15px;">
                    <!-- 結果情報（ノード数、出力先など） -->
                </div>
                <div style="margin-bottom: 10px;">
                    <label style="font-weight: bold;">生成されたコード:</label>
                </div>
                <textarea id="code-result-preview" rows="20" readonly style="width: 100%; font-family: 'Consolas', 'Courier New', monospace; font-size: 12px; background: #f5f5f5; border: 1px solid #ccc; padding: 10px;"></textarea>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button onclick="copyGeneratedCode()">📋 コピー</button>
                    <button onclick="openGeneratedFile()">📂 ファイルを開く</button>
                    <button onclick="closeCodeResultModal()">閉じる</button>
                </div>
            </div>
        </div>
    </div>

    <!-- arrow-drawing.jsの内容はapp-legacy.jsに統合されました -->
    <script src="app-legacy.js"></script>
</body>
</html>
