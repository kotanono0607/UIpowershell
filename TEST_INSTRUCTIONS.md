# 🧪 動作確認手順

## 📋 前提条件

- **OS**: Windows 10/11
- **PowerShell**: 7.x 以上
- **ブラウザ**: Chrome, Edge, または Firefox

---

## 🚀 起動手順

### Step 1: APIサーバーを起動

PowerShellを開いて以下を実行：

```powershell
# プロジェクトディレクトリに移動
cd C:\path\to\UIpowershell\adapter

# APIサーバーを起動
.\api-server-v2.ps1

# または、ブラウザ自動起動で
.\api-server-v2.ps1 -AutoOpenBrowser
```

**成功時の表示**:
```
==================================
UIpowershell - Polaris API Server V2
==================================

[OK] Polarisモジュールを読み込みました
[OK] JSON操作ユーティリティ
[OK] コードID管理JSON
[OK] コードメイン_コード本文_v2
[OK] 変数機能_変数管理UI_v2
[OK] メインF機能_ツールバー作成_v2
[OK] メインF機能_メインボタン処理_v2
[OK] 削除処理_v2
[OK] ネスト規制バリデーション_v2
[OK] state-manager
[OK] node-operations

==================================
✓ サーバー起動成功！
==================================

アクセス先: http://localhost:8080
```

---

### Step 2: ブラウザでアクセス

ブラウザを開いて以下のURLにアクセス：

#### Phase 4版（推奨）:
```
http://localhost:8080/index-v2.html
```

または

#### オリジナル版:
```
http://localhost:8080
```

---

## ✅ 動作確認項目

### 1. API接続テスト ⚡

1. ツールバーの「🔌 API接続テスト」ボタンをクリック
2. アラート「API接続テスト成功！」が表示されればOK
3. ステータスバーに「API: 2.0.0-phase3 ✓」と表示される

**期待される結果**:
```json
{
  "status": "ok",
  "timestamp": "2025-11-02 10:00:00",
  "version": "2.0.0-phase3",
  "phase": "Phase 3 - Adapter Layer Complete"
}
```

---

### 2. ノード追加 ➕

1. ツールバーの「➕ ノード追加」ボタンをクリック
2. モーダルが開くので以下を入力：
   - **ノードタイプ**: `process`（処理）
   - **表示テキスト**: `Excelを開く`
   - **コード**（オプション）: `Start-Process excel.exe`
3. 「追加」ボタンをクリック

**期待される結果**:
- キャンバスに新しいノードが追加される
- ノード数がステータスバーで更新される
- アラート「ノードを追加しました！ ID: xxxxx」が表示される

---

### 3. ノードのドラッグ&ドロップ 🖱️

1. キャンバス上のノードをマウスでドラッグ
2. 別の位置にドロップ

**期待される結果**:
- ノードが移動する
- スナップグリッド（10x10）に吸着する
- ネスト規制バリデーションが自動で動作（違反時はアラート表示）

---

### 4. 変数管理 📊

1. ツールバーの「📊 変数管理」ボタンをクリック
2. 「➕ 新しい変数を追加」ボタンをクリック
3. 以下を入力：
   - **変数名**: `ファイルパス`
   - **値**: `C:\data\file.xlsx`
   - **タイプ**: `単一値`
4. 「追加」ボタンをクリック

**期待される結果**:
- 変数一覧テーブルに新しい変数が表示される
- アラート「変数「ファイルパス」を追加しました」が表示される

---

### 5. フォルダ管理 📁

1. ツールバーの「📁 フォルダ」ボタンをクリック
2. 「➕ 新しいフォルダを作成」ボタンをクリック
3. フォルダ名を入力（例: `TestProject`）
4. 「作成」ボタンをクリック

**期待される結果**:
- `03_history\TestProject` フォルダが作成される
- フォルダ一覧に表示される
- アラートで作成されたパスが表示される

---

### 6. コード生成 ▶️

1. ノードを2-3個配置
2. ツールバーの「▶️ コード生成」ボタンをクリック

**期待される結果**:
- プログレスバーが表示される
- 生成完了後、以下の情報が表示される：
  - 出力先パス（例: `C:\path\to\output.ps1`）
  - 処理ノード数
- 実際にPowerShellファイルが生成される

---

### 7. ノード削除 🗑️

1. ノードを選択（現在は最後のノード）
2. ツールバーの「🗑️ 削除」ボタンをクリック
3. 確認ダイアログで「OK」

**期待される結果**:
- ノードが削除される
- セット削除対応の場合、複数ノードが削除される
  - 条件分岐: 3点セット（開始・中間・終了）
  - ループ: 2点セット（開始・終了）
- アラートで削除されたノード数が表示される

---

## 🐛 トラブルシューティング

### ❌ Polarisモジュールが見つからない

**エラーメッセージ**:
```
[エラー] Polarisモジュールの読み込みに失敗しました
```

**解決方法**:
```powershell
Install-Module -Name Polaris -Scope CurrentUser -Force
```

---

### ❌ ポートが既に使用中

**エラーメッセージ**:
```
[エラー] サーバー起動に失敗しました
ポート 8080 が既に使用中の可能性があります
```

**解決方法**:
```powershell
# 別のポートで起動
.\api-server-v2.ps1 -Port 8081

# ブラウザで http://localhost:8081 にアクセス
```

---

### ❌ ブラウザでアクセスできない

**症状**:
- ブラウザで「接続できません」エラー
- API接続テストが失敗

**確認事項**:
1. APIサーバーが起動しているか（PowerShellウィンドウを確認）
2. ファイアウォールの設定
3. `http://localhost:8080` でアクセス（`https`ではない）
4. ブラウザのコンソールでエラーを確認（F12キー）

---

### ❌ v2ファイルが読み込まれない

**エラーメッセージ**:
```
[エラー] ファイル *_v2.ps1 が見つかりません
```

**解決方法**:
```powershell
# プロジェクトディレクトリで実行しているか確認
pwd  # 現在のディレクトリを表示

# adapter/ディレクトリから起動する必要がある
cd C:\path\to\UIpowershell\adapter
.\api-server-v2.ps1
```

---

## 📊 動作確認チェックリスト

すべての項目が✅になればOK！

- [ ] APIサーバーが起動できる
- [ ] ブラウザでindex-v2.htmlにアクセスできる
- [ ] API接続テストが成功する
- [ ] ノード追加が動作する
- [ ] ノードのドラッグ&ドロップが動作する
- [ ] 変数管理UIが動作する
- [ ] フォルダ管理UIが動作する
- [ ] コード生成が動作する
- [ ] ノード削除が動作する
- [ ] セット削除（条件分岐・ループ）が動作する
- [ ] ドロップバリデーションが動作する

---

## 📸 スクリーンショット例

### メイン画面
![メイン画面](docs/screenshot-main.png)

### ノード追加モーダル
![ノード追加](docs/screenshot-add-node.png)

### 変数管理
![変数管理](docs/screenshot-variables.png)

### コード生成
![コード生成](docs/screenshot-generate.png)

---

## 📞 サポート

問題が解決しない場合は、以下の情報を添えて報告してください：

1. **エラーメッセージ**（PowerShellとブラウザコンソール両方）
2. **環境情報**:
   - Windows バージョン
   - PowerShell バージョン（`$PSVersionTable.PSVersion`）
   - ブラウザとバージョン
3. **実行したコマンド**
4. **期待した動作と実際の動作**

---

## 🎉 動作確認完了後

すべてのテストが成功したら、以下のドキュメントを参照して実際の開発を始めてください：

- **Phase 2詳細**: `MIGRATION_LOG_*_v2.md`（各v2ファイルの詳細）
- **Phase 3詳細**: `adapter/PHASE3_COMPLETE.md`（APIエンドポイント一覧）
- **Phase 4詳細**: `ui/PHASE4_COMPLETE.md`（フロントエンド実装詳細）
- **プロジェクト全体**: `MIGRATION_PROJECT_COMPLETE.md`（全体サマリー）

---

**最終更新**: 2025-11-02
**対象バージョン**: Phase 4完了版（v2.0.0-phase3）
