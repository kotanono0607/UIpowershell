# HTML/CSS/JS移行時のps1ファイル対応一覧

**移行アプローチ**: アダプター層方式（既存コード70%再利用）
**更新日**: 2025-11-02

---

## 📊 ファイル分類サマリー

| 分類 | ファイル数 | 対応 |
|-----|----------|------|
| 🗑️ **削除（UI層）** | 10ファイル | HTML/JSに完全置換 |
| 🔧 **修正（ビジネスロジック層）** | 6ファイル | UI依存を除去して再利用 |
| ✅ **そのまま使用（データ層）** | 4ファイル | 変更不要 |
| 🆕 **新規作成（アダプター層）** | 3ファイル | REST API等 |

---

## 🗑️ 削除するps1ファイル（10ファイル）

これらのファイルは**HTML/CSS/JavaScript**に完全に置き換わります。

### UI描画・レイアウト関連（7ファイル）

| # | ファイル名 | 理由 | HTML/JSでの代替 |
|---|-----------|------|----------------|
| 1 | `02-1_フォーム基礎構築.ps1` | Windows Formsのフォーム・パネル作成 | Tauri/Electronのウィンドウ |
| 2 | `02-3_ボタン作成管理.ps1` | Windows Formsのボタン動的生成 | React/Vueコンポーネント |
| 3 | `02-4_ボタン操作配置.ps1` | ボタンの配置・移動処理 | React Flow / Cytoscape.js |
| 4 | `02-5_コンテキストメニュー編集.ps1` | 右クリックメニュー | HTML/CSSコンテキストメニュー |
| 5 | `02-7_矢印描画.ps1` | GDI+による矢印描画 | **React Flowが自動描画** |
| 6 | `02-8_階層パス表示.ps1` | パス表示UI | React/Vueコンポーネント |
| 7 | `05_メインフォームUI_矢印処理.ps1` | 矢印の表示/非表示制御 | React Flow / SVG |

### UI操作・イベント処理関連（3ファイル）

| # | ファイル名 | 理由 | HTML/JSでの代替 |
|---|-----------|------|----------------|
| 8 | `06_メインフォームUI_フレーム移動.ps1` | パネルのアニメーション移動 | CSS Transitions / Animations |
| 9 | `03_メインフォームUI_ノードボタンメニュー処理.ps1` | ノードボタンのメニュー処理 | Reactイベントハンドラー |
| 10 | `04_メインフォームUI_スクリプト処理.ps1` | スクリプト化UI処理 | React/Vueコンポーネント |

---

## 🔧 修正するps1ファイル（6ファイル）

これらのファイルは**UI依存部分を除去**して再利用します。

### 修正レベル: 軽微（UI操作を条件分岐化）

| # | ファイル名 | 修正内容 | 修正箇所 |
|---|-----------|---------|---------|
| 1 | `12_コードメイン_コード本文.ps1` | `$メインフォーム.Hide()/Show()`を条件分岐化 | 12-13行目、49行目 |
| 2 | `10_変数機能_変数管理UI.ps1` | ダイアログ表示を条件分岐化 | フォーム表示部分 |

**修正例**:
```powershell
# Before
function 00_文字列処理内容 {
    $メインフォーム.Hide()
    # ビジネスロジック
    $メインフォーム.Show()
}

# After
function 00_文字列処理内容_v2 {
    param([bool]$showUI = $false)

    if ($showUI -and $global:メインフォーム) {
        $global:メインフォーム.Hide()
    }
    # ビジネスロジック（変更なし）
    if ($showUI -and $global:メインフォーム) {
        $global:メインフォーム.Show()
    }

    return $result  # 戻り値を追加
}
```

---

### 修正レベル: 中程度（データ構造の抽象化が必要）

| # | ファイル名 | 修正内容 | 修正難易度 |
|---|-----------|---------|-----------|
| 3 | `08_メインF機能_メインボタン処理.ps1` | `$global:レイヤー1.Controls`を抽象化 | ★★★☆☆ |
| 4 | `07_メインF機能_ツールバー作成.ps1` | ツールバーボタンの処理を抽象化 | ★★☆☆☆ |

**修正例**:
```powershell
# Before
function 実行イベント {
    $buttons = $global:レイヤー1.Controls |
               Where-Object { $_ -is [System.Windows.Forms.Button] } |
               Sort-Object { $_.Location.Y }

    foreach ($button in $buttons) {
        $buttonColor = $button.BackColor.Name
        $buttonName = $button.Name
        # ...
    }
}

# After
function 実行イベント_v2 {
    param(
        [array]$nodes  # HTML/JSから渡されるノード配列
    )

    # ノードをY座標でソート
    $sortedNodes = $nodes | Sort-Object { $_.y }

    foreach ($node in $sortedNodes) {
        $nodeColor = $node.color
        $nodeId = $node.id
        # ビジネスロジック（ほぼ変更なし）
        $取得したエントリ = IDでエントリを取得 -ID $nodeId
    }
}
```

---

### 修正レベル: 大規模（ロジックの分離が必要）

| # | ファイル名 | 修正内容 | 修正難易度 |
|---|-----------|---------|-----------|
| 5 | `02-2_ネスト規制バリデーション.ps1` | Windows Formsオブジェクト依存を除去 | ★★★★☆ |
| 6 | `02-6_削除処理.ps1` | Panel.Controlsへの直接アクセスを除去 | ★★★☆☆ |

**修正例**:
```powershell
# Before
function ドロップ禁止チェック_ネスト規制 {
    param(
        [System.Windows.Forms.Panel]$フレーム,
        [System.Windows.Forms.Button]$移動ボタン,
        [int]$設置希望Y
    )

    $全ボタン = $フレーム.Controls |
                Where-Object { $_ -is [System.Windows.Forms.Button] }
    # ...
}

# After
function ドロップ禁止チェック_ネスト規制_v2 {
    param(
        [array]$全ノード,      # HTML/JSから渡される
        [string]$移動ノードID,
        [int]$設置希望Y,
        [int]$レイヤー番号
    )

    # 同じレイヤーのノードをフィルタ
    $レイヤーノード = $全ノード | Where-Object { $_.layer -eq $レイヤー番号 }
    # ビジネスロジックは同じ
}
```

---

## ✅ そのまま使用できるps1ファイル（4ファイル）

これらのファイルは**UI依存がない**ため、変更不要です。

| # | ファイル名 | 理由 | 使用方法 |
|---|-----------|------|---------|
| 1 | `09_変数機能_コードID管理JSON.ps1` | Pure ビジネスロジック（JSON操作のみ） | アダプター層から呼び出し |
| 2 | `00_共通ユーティリティ_JSON操作.ps1` | ファイルI/Oのみ | アダプター層から呼び出し |
| 3 | `13_コードサブ汎用関数.ps1` | コード生成ロジック | そのまま使用 |
| 4 | `14_コードサブ_EXCEL.ps1` | Excel操作ロジック | そのまま使用 |

**使用例**:
```powershell
# アダプター層からそのまま呼び出せる
. ".\09_変数機能_コードID管理JSON.ps1"
. ".\00_共通ユーティリティ_JSON操作.ps1"

New-PolarisRoute -Path "/api/nodes" -Method POST -ScriptBlock {
    $body = $Request.Body | ConvertFrom-Json

    # ✅ 既存関数をそのまま使用
    $id = IDを自動生成する
    エントリを追加_指定ID -ID $id -文字列 $body.code

    $Response.Json(@{ success = $true; id = $id })
}
```

---

## 🆕 新規作成するファイル（3ファイル）

HTML/JSとPowerShellを繋ぐ**アダプター層**を新規作成します。

| # | ファイル名 | 役割 | 行数目安 |
|---|-----------|------|---------|
| 1 | `adapter/api-server.ps1` | REST APIサーバー（Polaris） | 200-300行 |
| 2 | `adapter/state-manager.ps1` | グローバル変数の状態管理 | 100-150行 |
| 3 | `adapter/node-operations.ps1` | ノード操作のラッパー関数 | 150-200行 |

---

## 📁 ディレクトリ構造の変化

### Before（現在）

```
UIpowershell/
├── 01_メインフォーム_メイン.ps1        ← メインエントリポイント
├── 02-1_フォーム基礎構築.ps1          ← 🗑️ 削除
├── 02-2_ネスト規制バリデーション.ps1   ← 🔧 修正
├── 02-3_ボタン作成管理.ps1             ← 🗑️ 削除
├── 02-4_ボタン操作配置.ps1             ← 🗑️ 削除
├── 02-5_コンテキストメニュー編集.ps1   ← 🗑️ 削除
├── 02-6_削除処理.ps1                   ← 🔧 修正
├── 02-7_矢印描画.ps1                   ← 🗑️ 削除
├── 02-8_階層パス表示.ps1               ← 🗑️ 削除
├── 03_メインフォームUI_ノードボタンメニュー処理.ps1 ← 🗑️ 削除
├── 04_メインフォームUI_スクリプト処理.ps1 ← 🗑️ 削除
├── 05_メインフォームUI_矢印処理.ps1    ← 🗑️ 削除
├── 06_メインフォームUI_フレーム移動.ps1 ← 🗑️ 削除
├── 07_メインF機能_ツールバー作成.ps1   ← 🔧 修正
├── 08_メインF機能_メインボタン処理.ps1 ← 🔧 修正
├── 09_変数機能_コードID管理JSON.ps1    ← ✅ そのまま使用
├── 10_変数機能_変数管理UI.ps1          ← 🔧 修正
├── 11_変数機能_変数管理を外から読み込む関数.ps1 ← ✅ そのまま使用
├── 12_コードメイン_コード本文.ps1      ← 🔧 修正
├── 13_コードサブ汎用関数.ps1           ← ✅ そのまま使用
├── 14_コードサブ_EXCEL.ps1             ← ✅ そのまま使用
├── 15_コードサブ_if文条件式作成.ps1    ← ✅ そのまま使用
├── 16_スナップショット機能.ps1         ← ✅ そのまま使用
└── 00_共通ユーティリティ_*.ps1        ← ✅ そのまま使用
```

---

### After（移行後）

```
UIpowershell/
├── 【フロントエンド】
│   ├── src/
│   │   ├── App.jsx                      ← 🆕 メインUI（React）
│   │   ├── components/
│   │   │   ├── WorkflowEditor.jsx       ← 🆕 フローエディタ
│   │   │   ├── NodePalette.jsx          ← 🆕 ノードパレット
│   │   │   └── Toolbar.jsx              ← 🆕 ツールバー
│   │   ├── styles/
│   │   │   └── App.css                  ← 🆕 スタイル
│   │   └── api/
│   │       └── client.js                ← 🆕 APIクライアント
│   ├── index.html
│   └── package.json
│
├── 【アダプター層】
│   ├── adapter/
│   │   ├── api-server.ps1               ← 🆕 REST APIサーバー
│   │   ├── state-manager.ps1            ← 🆕 状態管理
│   │   └── node-operations.ps1          ← 🆕 ノード操作ラッパー
│   │
│   └── validation/
│       └── node-validation-v2.ps1       ← 🆕 UI非依存バリデーション
│
├── 【ビジネスロジック層】
│   ├── 08_メインF機能_メインボタン処理_v2.ps1  ← 🔧 修正版
│   ├── 12_コードメイン_コード本文_v2.ps1        ← 🔧 修正版
│   ├── 09_変数機能_コードID管理JSON.ps1         ← ✅ そのまま
│   ├── 13_コードサブ汎用関数.ps1                ← ✅ そのまま
│   ├── 14_コードサブ_EXCEL.ps1                  ← ✅ そのまま
│   ├── 15_コードサブ_if文条件式作成.ps1         ← ✅ そのまま
│   └── 16_スナップショット機能.ps1              ← ✅ そのまま
│
├── 【データアクセス層】
│   └── 00_共通ユーティリティ_*.ps1             ← ✅ そのまま
│
├── 【削除されたファイル（アーカイブ推奨）】
│   └── archive/
│       ├── 01_メインフォーム_メイン.ps1         ← 🗑️ 削除
│       ├── 02-1_フォーム基礎構築.ps1            ← 🗑️ 削除
│       ├── 02-3_ボタン作成管理.ps1              ← 🗑️ 削除
│       ├── 02-4_ボタン操作配置.ps1              ← 🗑️ 削除
│       ├── 02-5_コンテキストメニュー編集.ps1    ← 🗑️ 削除
│       ├── 02-7_矢印描画.ps1                    ← 🗑️ 削除
│       ├── 02-8_階層パス表示.ps1                ← 🗑️ 削除
│       ├── 03_メインフォームUI_ノードボタンメニュー処理.ps1 ← 🗑️ 削除
│       ├── 04_メインフォームUI_スクリプト処理.ps1 ← 🗑️ 削除
│       ├── 05_メインフォームUI_矢印処理.ps1     ← 🗑️ 削除
│       └── 06_メインフォームUI_フレーム移動.ps1 ← 🗑️ 削除
│
├── 03_history/                          ← ✅ そのまま
├── 00_code/                             ← ✅ そのまま
├── 01_tools/                            ← ✅ そのまま
└── 02_modules/                          ← ✅ そのまま
```

---

## 📋 移行チェックリスト

### Phase 0: 準備

- [ ] 既存コードのバックアップ作成
- [ ] `archive/`ディレクトリ作成
- [ ] Git ブランチ作成（例: `feature/html-migration`）

---

### Phase 1: 削除するファイルをアーカイブ（1日）

```bash
# アーカイブディレクトリ作成
mkdir archive

# UI層のファイルを移動
mv 02-1_フォーム基礎構築.ps1 archive/
mv 02-3_ボタン作成管理.ps1 archive/
mv 02-4_ボタン操作配置.ps1 archive/
mv 02-5_コンテキストメニュー編集.ps1 archive/
mv 02-7_矢印描画.ps1 archive/
mv 02-8_階層パス表示.ps1 archive/
mv 03_メインフォームUI_ノードボタンメニュー処理.ps1 archive/
mv 04_メインフォームUI_スクリプト処理.ps1 archive/
mv 05_メインフォームUI_矢印処理.ps1 archive/
mv 06_メインフォームUI_フレーム移動.ps1 archive/
mv 01_メインフォーム_メイン.ps1 archive/
```

---

### Phase 2: 修正するファイルのバージョン2を作成（2-3週間）

- [ ] `12_コードメイン_コード本文_v2.ps1` 作成
- [ ] `08_メインF機能_メインボタン処理_v2.ps1` 作成
- [ ] `02-2_ネスト規制バリデーション_v2.ps1` 作成
- [ ] `02-6_削除処理_v2.ps1` 作成
- [ ] `10_変数機能_変数管理UI_v2.ps1` 作成
- [ ] `07_メインF機能_ツールバー作成_v2.ps1` 作成

---

### Phase 3: アダプター層を作成（2-4週間）

- [ ] `adapter/api-server.ps1` 作成
- [ ] `adapter/state-manager.ps1` 作成
- [ ] `adapter/node-operations.ps1` 作成
- [ ] `validation/node-validation-v2.ps1` 作成

---

### Phase 4: HTML/JSフロントエンドを作成（4-6週間）

- [ ] Tauriプロジェクト初期化
- [ ] `src/App.jsx` 作成
- [ ] `src/components/WorkflowEditor.jsx` 作成
- [ ] `src/api/client.js` 作成

---

## 🎯 ファイル対応のまとめ

| 対応 | ファイル数 | 工数目安 |
|-----|----------|---------|
| 🗑️ **削除（アーカイブ）** | 10ファイル | 1日 |
| 🔧 **修正（v2作成）** | 6ファイル | 2-3週間 |
| ✅ **そのまま使用** | 4ファイル | 0日 |
| 🆕 **新規作成（アダプター）** | 3ファイル | 2-4週間 |
| 🆕 **新規作成（フロントエンド）** | 5-10ファイル | 4-6週間 |

**総工数**: 2-3ヶ月（フルタイム開発者1名）

---

## 💡 重要な注意点

### 1. アーカイブ推奨（削除しない）

削除対象のファイルは**完全に削除せず、`archive/`ディレクトリに移動**することを推奨します。

**理由**:
- 既存のロジックを参照する必要がある
- ロールバックの可能性
- ドキュメントとしての価値

---

### 2. 段階的な移行

**一度に全ファイルを差し替えない**でください。

**推奨アプローチ**:
1. まずアダプター層を構築
2. 1つのps1ファイルを修正してテスト
3. 動作確認後、次のファイルに進む
4. 最後にフロントエンドを統合

---

### 3. バージョン管理

修正するファイルは**`_v2`サフィックス**を付けて新規作成します。

**例**:
```
12_コードメイン_コード本文.ps1       ← 既存（archive/へ移動）
12_コードメイン_コード本文_v2.ps1    ← 新バージョン（UI非依存）
```

これにより、問題があれば既存版に戻せます。

---

## 📞 サポート

ファイル移行で問題が発生した場合:
1. `archive/`ディレクトリから既存版を復元
2. Git でコミット履歴を確認
3. 段階的に再実装

---

**Document Version**: 1.0
**Last Updated**: 2025-11-02
**Author**: Claude (AI Technical Assessor)
